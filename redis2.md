# Миниатюрный Redis на Python

## Введение
В этом руководстве мы создадим упрощенную версию Redis - популярного хранилища ключ-значение. Наш сервер будет поддерживать базовые операции и использовать собственный протокол для обмена данными между клиентом и сервером.

## Исследование предметной области
### 1. Анализ Redis
- Изучили базовые команды Redis (GET, SET, DELETE и др.)
- Проанализировали протокол RESP (REdis Serialization Protocol)
- Определили поддерживаемые типы данных


### 2. Проектирование архитектуры




### 3. Выбор технологий
- Python 3.x для реализации
- Gevent для асинхронной обработки соединений
- Стандартные библиотеки для работы с сетью






## Идея проекта
- Написание простого серверного хранилища данных для очереди задач Huey
- Цель: использование Redis-подобного хранилища для отслеживания заданий и результатов

## Структура сервера
- Сервер с callback-функциями для обработки подключений
- Логика обработки запросов и отправки ответов клиентам

## Реализация сервера
Основной класс сервера:

## Реализация клиента
Пример выполнения команды:

```python
def execute(self, *args):
    self._protocol.write_response(self._fh, args)
    resp = self._protocol.handle_request(self._fh)
    if isinstance(resp, Error):
        raise CommandError(resp.message)
    return resp
```

## Обработка протокола
- Реализация протокола Redis для сериализации данных
- Класс `ProtocolHandler` для:
  - Разбора входящих запросов
  - Формирования ответов клиентам
![Класс `ProtocolHandler`](journal.png)

## Выполнение команд
- Метод `get_response()` для исполнения клиентских команд
- Система сопоставления команд с соответствующими обработчиками

```python
def get_response(self, command, *args):
    handler = self.command_handlers.get(command)
    if not handler:
        raise ProtocolError(f"Неизвестная команда: {command}")
    return handler(*args)
```

## Обработка исключений

- Использование исключений для уведомлений о проблемах
- Обработка отключений клиентов и ошибок при обработке команд

## Преимущества разделения задач

- Обработка протокола в отдельном классе для повторного использования
- Использование файлообразной оболочки для абстрагирования от сокетов


## Клиент для взаимодействия с сервером

- Клиент использует класс Обработчик протоколов для взаимодействия с сервером.
- Клиент отправляет команды, закодированные в виде списков, и анализирует ответы сервера.
- Клиентские методы включают получение, установку, удаление, очистку, многопоточное получение и многопоточную установку.



## Диаграммы
Состояния сервера:


## Тестирование сервера и клиента

- Для тестирования сервера можно использовать Python для загрузки сервера из мобильной сети.
- Клиент можно импортировать из модуля сервера и запускать команды.
- Пример использования клиента для выполнения команд и получения ответов.

## Заключение

В этом руководстве мы создали упрощенную версию Redis-сервера на Python. Сервер поддерживает базовые операции с ключами и значениями, использует собственный протокол для обмена данными и может обрабатывать несколько клиентов одновременно благодаря gevent.

Полный код проекта доступен в GitHub репозитории.(https://roilesgame.github.io/Practice-Project-1st-course/)

